Ext.onReady(function(){let e=0,t=0;Ext.define("Ext.button.MyButton",{extend:"Ext.button.Button",enable:function(e,t){t||this.callParent(arguments)},disable:function(e,t){t||this.callParent(arguments)}}),Ext.define("Ext.form.field.Month",{extend:"Ext.form.field.Date",alias:"widget.monthfield",requires:["Ext.picker.Month"],alternateClassName:["Ext.form.MonthField","Ext.form.Month"],selectMonth:null,grid:null,createPicker:function(){let e,t=this,i=Ext.String.format;return e={pickerField:t,ownerCmp:t,renderTo:document.body,floating:!0,hidden:!0,focusOnShow:!0,minDate:t.minValue,maxDate:t.maxValue,disabledDatesRE:t.disabledDatesRE,disabledDatesText:t.disabledDatesText,disabledDays:t.disabledDays,disabledDaysText:t.disabledDaysText,format:t.format,showToday:t.showToday,startDay:t.startDay,minText:i(t.minText,t.formatDate(t.minValue)),maxText:i(t.maxText,t.formatDate(t.maxValue)),listeners:{select:{scope:t,fn:t.onSelect},monthdblclick:{scope:t,fn:t.onOKClick},yeardblclick:{scope:t,fn:t.onOKClick},OkClick:{scope:t,fn:t.onOKClick},CancelClick:{scope:t,fn:t.onCancelClick}},keyNavConfig:{esc:function(){t.collapse()}}},Ext.isChrome&&(t.originalCollapse=t.collapse,e.listeners.boxready={fn:function(){this.picker.el.on({mousedown:function(){this.collapse=Ext.emptyFn},mouseup:function(){this.collapse=this.originalCollapse},scope:this})},scope:t,single:!0}),Ext.create("Ext.picker.Month",e)},onCancelClick:function(){this.selectMonth=null,this.collapse()},onOKClick:function(){let e=this;e.selectMonth&&(e.setValue(e.selectMonth),e.fireEvent("select",e,e.selectMonth)),e.collapse(),e.grid.getSelectionModel().deselectAll(),e.grid.getStore().load()},onSelect:function(e,t){this.selectMonth=new Date(t[0]+1+"/1/"+t[1])}}),Ext.define("Ext.form.field.SearchText",{extend:"Ext.form.field.Text",emptyText:"Buscar...",width:150,grid:null,listeners:{change:function(e,t){if(e.getTrigger("clear").setVisible(t),Ext.isEmpty(Ext.String.trim(e.getValue()))){let t=e.marked;e.setMarked(!1),t&&this.grid.getStore().loadPage(1),e.getTrigger("search").hide()}else e.getTrigger("search").show(),e.marked&&e.setMarked(!0)},specialkey:function(e,t){let i=e.getValue();Ext.isEmpty(Ext.String.trim(i))||t.getKey()!==t.ENTER?t.getKey()===t.BACKSPACE&&t.getKey()===t.DELETE&&t.ctrlKey&&t.getKey()===t.V&&e.setMarked(!1):(e.setMarked(!0),this.grid.getStore().loadPage(1))}},triggers:{search:{cls:Ext.baseCSSPrefix+"form-search-trigger",hidden:!0,handler:function(){let e=this.getValue();if(!Ext.isEmpty(Ext.String.trim(e))){this.setMarked(!0);let t={};t[this.nameValue]=e,this.grid.getStore().loadPage(1,{params:t})}}},clear:{cls:Ext.baseCSSPrefix+"form-clear-trigger",hidden:!0,handler:function(){this.setValue(null),this.updateLayout(),this.marked&&this.grid.getStore().loadPage(1),this.setMarked(!1)}}},setMarked:function(e){let t=this.getEl(),i="#"+this.getId();this.marked=e,e?(t.down(i+"-inputEl").addCls("x-form-invalid-field x-form-invalid-field-default"),t.down(i+"-inputWrap").addCls("form-text-wrap-invalid"),t.down(i+"-triggerWrap").addCls("x-form-trigger-wrap-invalid")):(t.down(i+"-inputEl").removeCls("x-form-invalid-field x-form-invalid-field-default"),t.down(i+"-inputWrap").removeCls("form-text-wrap-invalid"),t.down(i+"-triggerWrap").removeCls("x-form-trigger-wrap-invalid"))}});const i={DATE_FORMAT:"d/m/Y",DATETIME_FORMAT:"d/m/Y H:i",NOTIFICACION_GLOBAL:1,NOTIFICACION_GRUPO:2,NOTIFICACION_USUARIO:3,NOTIFICACIONES:["GLOBAL","GRUPO","USUARIO"],EVENTO_INSERT:1,EVENTO_UPDATE:2,EVENTO_DELETE:3,EVENTOS:{1:"INSERT",2:"UPDATE",3:"DELETE"},FORMATO_PDF:1,FORMATO_EXCEL:2,FORMATO_WORD:3,FORMATO_PNG:4},o={initialize:function(e){let t=performance.now();if(Object.assign(this,this,e),this.current_year=e.current_year,this.current_month=e.current_month,this.selected_year=e.selected_year,this.selected_month=e.selected_month,this.min_month=e.min_month,this.min_year=e.min_year,this.interval_handler_key=-1,this.timeout_handler_key=-1,this.templates=[],this.container=Ext.get("container"),this.debug("You are in dev mode.").debug(" > User:",'"'+this.user.username+'"').debug(" > Route:",this.route?'"'+this.route+'".':null).debug(" > Module:",this.module?'"'+this.module+'".':null).debug(" > Base path:",'"'+this.base_url+'".').debug(" > Notifications:",this.notifications,"(query interval is",this.notifications_interval,"sec).").debug(" > Libraries:",["ExtJS@"+Ext.getVersion("extjs").version+(Ext.getVersion("extjs").major>5?"("+Ext.theme.name+")":""),"JQuery@"+$.fn.jquery,"Bootstrap@"+$.fn.tooltip.Constructor.VERSION]+".").debug(" > Año:",this.current_year).debug(" > Mes:",this.current_month).debug(" > Año Seleccionado:",this.selected_year).debug(" > Mes Seleccionado:",this.selected_month).debug(" > Año Min:",this.min_month).debug(" > Mes Max:",this.min_year),this.buildTemplates().configureAlerts().buildNavbar().buildUserInfo().buildNotifier().startNotifierTask().buildReloader().buildHelper().configureExtJS(),!this.verbose&&this.session_timeout){let e=this;$.idleTimer(1e3*this.session_timeout).on("idle.idleTimer",function(t,i,o,n){window.location.href=e.buildURL("logout?expired=true&timeout="+e.session_timeout)})}"Portadores"===this.module&&(null!==this.selected_year&&0!==this.selected_year||(this.selected_year=this.current_year,this.selected_month=this.current_month,this.showWindowPeriodo())),this.debug("App was initialized in",(performance.now()-t).toFixed(2),"ms.")},showWindowPeriodo:function(){var i=Ext.create("Ext.window.Window",{modal:!0,onEsc:Ext.emptyFn,closable:!1,title:"Seleccionar per&iacute;odo",items:[{xtype:"form",layout:"column",id:"form_periodo_id",bodyPadding:10,standardSubmit:!0,items:[{xtype:"monthpicker",showButtons:!1,id:"periodo",name:"periodo",editable:!1,minDate:new Date("1/12/2018"),listeners:{select:function(i,n,a){console.log(n[1]);let r=!1;n[0]+1>e&&n[1]===t?(o.showAlert("No puede seleccionar períodos posteriores","warning"),Ext.getCmp("btn_acept").setDisabled(!0),r=!0):Ext.getCmp("btn_acept").setDisabled(!1),Ext.getCmp("btn_acept").setDisabled(r)}}}]}],listeners:{afterrender:function(n){o.request("GET",o.buildURL("/portadores/utiles/getCurrentPeriodo"),[],null,null,function(i){e=i.mes,t=i.anno,Ext.getCmp("periodo").setValue([i.mes-1,i.anno])},function(e){i.show()},null,!1,i)},scope:this},buttons:[{text:"Aceptar",id:"btn_acept",handler:function(){var e={};e.mes_seleccionado=Ext.getCmp("periodo").getValue()[0],e.anno_seleccionado=Ext.getCmp("periodo").getValue()[1];var t=o.buildURL("/portadores/utiles/cambiarPeriodo");i.hide(),o.request("POST",t,e,null,null,function(e){i.close(),0!==o.selected_year&&o.reset()},function(e){i.show()},null,!0)}}]});i.show()},FilterStore:function(e,t){var i=e.getProxy().url,o=i.indexOf("?",0);i=-1!==o?i.substr(0,o):i,i+="?"+Ext.Object.toQueryString(t),e.getProxy().url=i},round:function(e,t){var i=Number(e);return"number"==typeof t&&(t=Math.pow(10,t),i=Math.round(e*t)/t),i},getMonthName:function(e){return e>=0&&e<=12?new Array("Año","Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre")[e]:"Error, parámetro incorrecto"},getDaysInMonth:function(e,t){return 1===t||3===t||5===t||7===t||8===t||10===t||12===t?31:4===t||6===t||9===t||11===t?30:e%100==0&&e%400!=0||e%4!=0?28:29},getDateInWeek:function(e){var t=e.split("/"),i=t[2],n=t[1],a=t[0],r=new Date(i,n-1,a),s=(7-(parseFloat(r.getDay())+1)+parseFloat(r.getDate())).toString();return parseFloat(s)>o.getDaysInMonth(i,n)?o.getDaysInMonth(i,n)+"/"+n+"/"+i:(s<10?"0"+s:s)+"/"+n+"/"+i},configureExtJS:function(){var e=this;Ext.Ajax.addListener("beforerequest",function(t){e.route&&t.setExtraParams({view_id:e.route})}),Ext.Ajax.setTimeout(1e3*this.ajax_timeout),Ext.setGlyphFontFamily("Font Awesome\\ 5 Free"),Ext.tip.QuickTipManager.init(),Ext.util.Format.decimalSeparator=".",Ext.util.Format.thousandSeparator=",",Ext.define("",{override:"Ext.grid.RowEditor",initComponent:function(){this.callParent()},saveBtnText:"Aceptar",cancelBtnText:"Cancelar"})},render:function(e){$("#container").children().hide();let t=this;return e.on("destroy",function(){!0!==e.propagate&&void 0!==e.propagate||t.reset()}),this.container&&(e.setSize(this.container.getWidth(),this.container.getHeight()),e.render(this.container.getId())),this},isBusy:function(){return!Ext.isEmpty(Ext.data.StoreManager.findBy(function(e,t){return!e.isEmptyStore&&"notifications"!==t&&e.isLoading()}))},request:function(e,t,i,o,n,a,r,s,l,d){d?d.mask("Loading..."):"boolean"!=typeof d&&this.mask(),"function"==typeof o&&o.call(this);let c={};Ext.Object.each(i,function(e,t){Ext.isArray(t)?Ext.each(t,function(t,i){c[e+"["+i+"]"]=t}):c[e]=t}),i=c;let p=this,u=Ext.Object.merge(s||{},{url:t,params:i,method:e,callback:function(e,t,i){let o,s,c;if(d?d.unmask():p.unmask(),"function"==typeof n&&n.call(this,i),t)i=e.hasOwnProperty("binary")?i:Ext.decode(i.responseText,!0),"function"==typeof a&&a.call(this,i),l||(o=i&&i.hasOwnProperty("message")?i.message:"La solicitud ha sido procesada correctamente",s=i&&i.hasOwnProperty("error")?"<br><em><small>"+i.error+"</small></em>":"",c=i&&i.hasOwnProperty("success")?!0===i.success?"success":"danger":"success",p.showAlert(o+s,c,"success"!==c?1e4:void 0));else{if("function"==typeof r&&r.call(this,i),o=i&&i.hasOwnProperty("statusText")?i.statusText:"La solicitud no pudo ser procesada",s="",p.verbose&&i&&i.hasOwnProperty("responseText")){let e=p.parseError(i.responseText);s="<br><em><small>"+(e||i.responseText)+"</small></em>"}p.showAlert(o+s,"danger",1e4)}}});Ext.Ajax.request(u)},submit:function(e,t,i,o,n,a){this.mask();let r=this,s=Ext.Object.merge(n||{},{url:t,success:function(e,t){console.log("success");let o=Ext.decode(t.response.responseText,!0);if(r.unmask(),"function"==typeof i&&i.call(this,o),!a){let e=o&&o.hasOwnProperty("message")?o.message:"La solicitud ha sido procesada correctamente",t=o&&o.hasOwnProperty("success")?!0===o.success?"success":"danger":"success";r.showAlert(e,t,"success"!==t?1e4:void 0)}},failure:function(e,t){console.log("failure");let i=Ext.decode(t.response.responseText,!0);r.unmask(),"function"==typeof o&&o.call(this,i);let n=i&&i.hasOwnProperty("message")?i.message:"La solicitud no pudo ser procesada";r.showAlert(n,"danger",1e4)}});e.submit(s)},parseError:function(e){let t=(new DOMParser).parseFromString(e,"text/html").getElementsByTagName("title");return 0!==t.length?t[0].innerHTML:""},mask:function(){return this.spot||(this.spot=Ext.create("Ext.ux.Spotlight",{animate:!1,easing:"easeOut",duration:300})),this.spot.show($("#spot").removeAttr("hidden").attr("id")),this},unmask:function(){return this.spot&&($("#spot").attr("hidden","hidden"),this.spot.hide(),delete this.spot),this},showAlert:function(e,t,i){if(Ext.isEmpty(e.trim()))return this;let o=this,n=$(".alert-notifier"),a=function(){n.removeClass("alert-info alert-warning alert-danger alert-success alert-secondary alert-dark").addClass("alert-"+(t||"info")).html(o.templates.alert_msg_tpl.apply({message:e,type:t||"info"})).fadeIn(),n.find("button").click(function(){o.closeAlert()});let a=$(".progress-bar"),r=(i>1e3?1e3:i)/i*100;o.interval_handler_key=setInterval(function(){let e=a.width()/a.parent().width()*100;100===Math.round(e)&&(e=100),a.width(e+r+"%")},1e3),o.timeout_handler_key=setTimeout(function(){n.fadeOut(1e3,function(){clearInterval(o.interval_handler_key)})},i)};return clearInterval(this.interval_handler_key),clearTimeout(this.timeout_handler_key),i=i||5e3,"block"===n.css("display")?n.fadeOut(150,function(){a()}):a(),this},closeAlert:function(){return $(".alert-notifier").hide(),clearInterval(this.interval_handler_key),clearTimeout(this.timeout_handler_key),this},debug:function(){let e=Array.prototype.slice.call(arguments);return e[0]="%c"+e[0],this.verbose&&console.log.apply(console,[e.join(" "),"color: #6c757d"]),this},buildTemplates:function(){return this.templates.nav_item_tpl=new Ext.Template('<li class="nav-item">','   <a class="nav-link" href="{url}">{text}</a>',"</li>",{compiled:!0,disableFormats:!0}),this.templates.submenu_item_tpl=new Ext.Template('<li class="nav-item">','   <a class="dropdown-item pl-2 pr-2" href="{url}">{text}</a>',"</li>",{compiled:!0,disableFormats:!0}),this.templates.dropdown_tpl=new Ext.Template('<li class="nav-item dropdown" id="{id}">','   <a class="nav-link dropdown-toggle pl-3 pr-3" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">{text}</a>','   <div class="dropdown-menu pt-1 pb-1" id="{div_id}"></div>',"</li>",{compiled:!0,disableFormats:!0}),this.templates.dropdown_submenu_tpl=new Ext.Template('<li class="dropdown dropdown-submenu" id="{id}">','   <a href="#" class="dropdown-item dropdown-toggle pl-3 pr-3" data-toggle="dropdown"><span class="mr-2">{text}</span></a>','   <ul id="{ul_id}" class="dropdown-menu pt-1 pb-1"></ul>',"</li>",{compiled:!0,disableFormats:!0}),this.templates.dropdown_header_tpl=new Ext.Template('<h5 class="dropdown-header pl-3 pr-3 small-caps text-danger" style="font-size: 1rem;">{text}</h5>',{compiled:!0,disableFormats:!0}),this.templates.dropdown_item_tpl=new Ext.Template('<a class="dropdown-item pl-3 pr-3" href="{url}">{text}</a>',{compiled:!0,disableFormats:!0}),this.templates.dropdown_item_help_tpl=new Ext.Template('<a class="dropdown-item mr-4 pl-3 pr-3" target="_blank" href="{url}"><i class="fas fa-question-circle float-right text-primary fa_inherit"></i>Ayuda</a>',{compiled:!0,disableFormats:!0}),this.templates.dropdown_item_about_tpl=new Ext.Template('<a class="dropdown-item mr-4 pl-3 pr-3" href="#" data-toggle="modal" data-target="#about"><i class="fas fa-info-circle float-right text-primary fa_inherit"></i>Acerca de</a>',{compiled:!0,disableFormats:!0}),this.templates.dropdown_item_logout_tpl=new Ext.Template('<a class="dropdown-item mr-4 pl-3 pr-3" href="{url}"><i class="fas fa-sign-out-alt float-right text-secondary fa_inherit"></i>Cerrar sesi&oacute;n</a>',{compiled:!0,disableFormats:!0}),this.templates.dropdown_item_periodo_tpl=new Ext.Template('<a class="dropdown-item mr-4 pl-3 pr-3" href="#" onclick="App.showWindowPeriodo()"><i class="fas fa-calendar-alt float-right text-primary fa_inherit"></i>Seleccionar Período</a>',{compiled:!0,disableFormats:!0}),this.templates.nav_item_logout_tpl=new Ext.Template('<a class="nav-link" href="{url}">Cerrar sesión&nbsp;<i class="fas fa-sign-out-alt mt-1"></i></a>',{compiled:!0,disableFormats:!0}),this.templates.divider_tpl=new Ext.Template('<div class="dropdown-divider mb-1 mt-1"></div>',{compiled:!0,disableFormats:!0}),this.templates.userinfo_popover_tpl=new Ext.XTemplate("<div class='row no-gutters'>","   <div class='col-md-2'>","       <i class='fas fa-user fa-fw'></i>","   </div>","   <div class='col-md-10'>{username}</div>","   <div class='w-100 mb-1'></div>","   <div class='col-md-2'>","       <i class='fas fa-clock fa-fw'></i>","   </div>","   <div class='col-md-10'>{created_at}</div>","   <tpl if='!Ext.isEmpty(email)'>","       <div class='w-100 mb-1'></div>","       <div class='col-md-2'>","           <i class='fas fa-envelope fa-fw'></i>","       </div>","       <div class='col-md-10'>{email}</div>","   </tpl>","</div>",{compiled:!0}),this.templates.notifier_popover_tpl=new Ext.Template("<div class='text-center'>{message}</div>",{compiled:!0,disableFormats:!0}),this.templates.helper_popover_tpl=new Ext.Template('<div class="text-danger text-uppercase text-center">{text}</div>',{compiled:!0,disableFormats:!0}),this.templates.alert_msg_tpl=new Ext.Template('<div class="p-0 pr-4 pl-1 d-flex">','   <div class="p-2 w-100">{message}</div>','   <button type="button" class="close p-0 pt-1 pr-2 flex-shrink-1" aria-label="Close"><span aria-hidden="true">&times;</span></button>',"</div>",'<div class="progress" style="height: 5px;">','   <div class="progress-bar progress-bar-striped progress-bar-animated bg-{type}" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 0"></div>',"</div>",{compiled:!0,disableFormats:!0}),this},configureAlerts:function(){let e=document.getElementById("notifier");return e?$._data(e,"events")?this:($("#notifier").click(this.showNotifications.bind(this)),this):this},startNotifierTask:function(){if(!this.notifierTask){let e=this,t=Ext.create("Ext.data.JsonStore",{storeId:"notifications",fields:["id","mensaje","tipo",{name:"fecha_creacion",type:"date",dateFormat:i.DATETIME_FORMAT}],proxy:{type:"ajax",url:e.buildURL("/notificacion/list"),reader:{rootProperty:"rows"}},pageSize:0,autoLoad:!1,autoDestroy:!1,listeners:{beforeLoad:function(t,i,o){e.currentOperation=i},load:function(t,i,o,n){e.notifications=o?i.length:0,e.currentOperation=null,e.buildNotifier()}}});this.notifierTask=(new Ext.util.TaskRunner).newTask({run:function(){t.isLoading()||t.reload()},interval:1e3*e.notifications_interval})}return this.notifierTask.start(),this},stopNotifierTask:function(){return this.notifierTask.stop(),this.currentOperation&&this.currentOperation.abort(),this},initTooltips:function(){$('[data-toggle="tooltip"]').tooltip()},reset:function(e,t){if(this.route=void 0,this.module=e,document.cookie=this.user.username+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;",window.history.pushState("","",this.base_url),document.title=this.app_name,$("#navbar-left").find(".active").removeClass("active"),$("#container").children().show(),this.container){let e=this.container.child(".x-panel");e&&e.component&&(e.component.propagate=!1,e.component.destroy())}return this.closeAlert().debug("The app was reset.")},buildURL:function(e){return this.base_url+(e.startsWith("/")?e.replace("/",""):e)},buildDropdown:function(e,t){return $(this.templates.dropdown_tpl.apply({id:e,text:t,div_id:e+"_dropdown-menu"}))},generateName:function(e){return e.trim().toLowerCase().replace(/ |\(|\)|\./g,"_")},buildLeftNavbar:function(){let e=$("#navbar-left").empty(),t=this;return $.each(this.routes,function(i,o){if(o.hasOwnProperty("module")&&o.module===t.module){let n=t.buildURL(o.path),a=o.text;if(o.hasOwnProperty("dropdown")){let i,r,s,l,d=o.dropdown,c=t.generateName(t.module);if("string"==typeof d){if(i=c+"_"+t.generateName(d)+"_A",0===$("#"+i).length&&e.append(t.buildDropdown(i,d)),r=$("#"+i+"_dropdown-menu"),o.hasOwnProperty("dropdown_header")){let e=o.dropdown_header;0===(s=$("#"+i+'_dropdown-menu > .dropdown-header:contains("'+e+'")').first()).length&&(s=$(t.templates.dropdown_header_tpl.apply({text:e})),r.append(s))}if(l=$(t.templates.dropdown_item_tpl.apply({url:n,text:a})),s&&0!==s.length){let e=s.nextUntil("h5").last();0!==e.length?e.after(l):s.after(l)}else r.append(l);o.hasOwnProperty("divider")&&!0===o.divider&&r.append($(t.templates.divider_tpl.apply()))}else{if("object"!=typeof d||!Array.isArray(d)||2!==d.length)return!0;if(i=c+"_"+t.generateName(d[0])+"_A",0===$("#"+i).length&&e.append(t.buildDropdown(i,d[0])),r=$("#"+i+"_dropdown-menu"),i=c+"_"+t.generateName(d[0])+"_submenu_"+t.generateName(d[1])+"_B",0===$("#"+i).length&&r.append($(t.templates.dropdown_submenu_tpl.apply({id:i,text:d[1],ul_id:i+"_dropdown-submenu"}))),o.hasOwnProperty("dropdown_header")){let e=o.dropdown_header;0===(s=$("#"+i+'_dropdown-menu > .dropdown-header:contains("'+e+'")').first()).length&&(s=$(t.templates.dropdown_header_tpl.apply({text:e})),$("#"+i+"_dropdown-submenu").append(s))}$("#"+i+"_dropdown-submenu").append($(t.templates.submenu_item_tpl.apply({url:n,text:a}))),o.hasOwnProperty("divider")&&!0===o.divider&&r.append($(t.templates.divider_tpl.apply()))}}else e.append($(t.templates.nav_item_tpl.apply({url:n,text:a})));t.route===i&&$('a[href="'+n+'"]').addClass("active").parents("li").children("a").addClass("active")}}),e.removeAttr("hidden").find("a").click(function(e){let i=$(this);!i.hasClass("dropdown-toggle")&&i.hasClass("active")&&i.parents("li").hasClass("active")&&(t.debug("Click event canceled: the link is active."),e.preventDefault())}),$(".dropdown-menu a.dropdown-toggle").on("click",function(e){return $(this).next().hasClass("show")||$(this).parents(".dropdown-menu").first().find(".show").removeClass("show"),$(this).next(".dropdown-menu").toggleClass("show"),$(this).parents("li.nav-item.dropdown.show").on("hidden.bs.dropdown",function(e){$(".dropdown-submenu .show").removeClass("show")}),!1}),$(".dropdown").on("shown.bs.dropdown",function(){let e=$(this).find(".dropdown-menu"),t=e.offset().left,i=e.outerWidth(),o=$("body").outerWidth();t+i>o&&e.offset({left:o-i})}),$(".dropdown-menu").find(".dropdown-divider:last").each(function(e,t){let i=$(t);i.is(":last-child")&&i.remove()}),this},buildRightNavbar:function(){let e=$("#navbar-right");if(e.children().last().remove(),this.module){let t,i=this,o=this.generateName(this.module);e.append(i.buildDropdown(o+"_dropdown",this.module)).find(".dropdown-menu").addClass("dropdown-menu-right"),t=$("#"+o+"_dropdown_dropdown-menu"),this.modules.forEach(function(e){if(e===i.module)return;let o=$(i.templates.dropdown_item_tpl.apply({url:"#",text:e})).click(function(){i.isBusy()?i.debug(":( the action could not be executed because the application is busy."):(i.reset(e,!1),i.buildNavbar())});t.append(o)}),this.modules.length>1&&t.append($(this.templates.divider_tpl.apply())),t.append($(this.templates.dropdown_item_help_tpl.apply({url:this.buildURL("help")}))).append($(this.templates.dropdown_item_about_tpl.apply())).append($(this.templates.divider_tpl.apply())).append($(this.templates.dropdown_item_periodo_tpl.apply())).append($(this.templates.dropdown_item_logout_tpl.apply({url:this.buildURL("logout")})))}else e.append($(this.templates.nav_item_logout_tpl.apply({url:this.buildURL("logout")})));return e.removeAttr("hidden"),this},buildUserInfo:function(){let e=$("#userdata"),t=this.templates.userinfo_popover_tpl.apply({username:this.user.username,fullname:this.user.fullname,created_at:this.user.created_at,email:this.user.email});return e.data("bs.popover")?e.data("bs.popover").config.content=t:e.popover({trigger:"hover",placement:"bottom",html:!0,content:t,container:"body"}),e.removeAttr("hidden"),this},buildNotifier:function(){let e=$("#notifier"),t=this.templates.notifier_popover_tpl.apply({message:void 0===this.notifications||0===this.notifications?"No tiene notificaciones pendientes":1===this.notifications?"Tiene 1 notificación pendiente":"Tiene "+this.notifications+" notificaciones pendientes"});return e.data("bs.popover")?e.data("bs.popover").config.content=t:e.popover({trigger:"hover",placement:"bottom",html:!0,content:t,container:"body"}),this.notifications>0?e.find("i").addClass("text-danger faa-horizontal animated effect"):e.find("i").removeClass("text-danger faa-horizontal animated effect"),e.removeAttr("hidden"),this},buildNavbar:function(){let e=0;return this.verbose&&(e=performance.now()),this.buildLeftNavbar().buildRightNavbar(),this.verbose&&this.debug(" > Building menu:",(performance.now()-e).toFixed(2),"ms."),$("ul.dropdown-menu [data-toggle=dropdown]").on("click",function(e){e.preventDefault(),e.stopPropagation(),$(this).parent().siblings().removeClass("open"),$(this).parent().toggleClass("open")}),this},buildReloader:function(){if(!this.verbose)return this;let e=document.getElementById("reloader");if($._data(e,"events"))return this;let t=$("#reloader"),i=this.templates.helper_popover_tpl.apply({text:"Recargar rutas (ONLY FROM DEV!!!)"}),o=this;return t.click(function(){if(o.isBusy())return void o.debug(":( the action could not be executed: the app is busy!.");o.closeAlert();let e=$(this).find("i");o.request("POST",o.buildURL("/routes/reload"),null,function(){e.removeClass("text-danger")},null,function(t){let i=t.data;o.reset(i.module||i.modules[0],!1).initialize(i),e.addClass("text-danger")})}),t.data("bs.popover")?t.data("bs.popover").config.content=i:t.popover({trigger:"hover",placement:"bottom",html:!0,content:i,container:"body"}),t.removeAttr("hidden"),this},showNotifications:function(){let e,t=this.stopNotifierTask(),o=$("#container"),n=Ext.getStore("notifications");Ext.create("Ext.window.Window",{title:"Notificaciones",height:.75*o.height(),width:.75*o.width(),layout:"fit",modal:!0,glyph:61664,tools:[{type:"refresh",tooltip:"Actualiza el listado de notificaciones",callback:function(e,t,i){e.down("gridpanel").getStore().reload()}}],items:{xtype:"gridpanel",selType:"checkboxmodel",viewConfig:{emptyText:'<div class="text-center">No tiene notificaciones pendientes</div>'},reserveScrollbar:!0,scrollable:"vertical",store:n,columns:[{xtype:"rownumberer",align:"center"},{text:"Mensaje",dataIndex:"mensaje",flex:3},{text:"Tipo",dataIndex:"tipo",align:"center",width:175,renderer:function(e){return'<div class="font-weight-bold">'+e+"</div>"}},{text:"Creado en",dataIndex:"fecha_creacion",xtype:"datecolumn",format:i.DATETIME_FORMAT,align:"center",width:200}],dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",layout:{pack:"center"},items:[{text:"Descartar",width:80,handler:function(e,i){let o=e.up("gridpanel"),n=Ext.Array.map(o.getSelection(),function(e){return e.get("id")}),a=t.buildURL("/notification/read");t.request("POST",a,{ids:n},null,null,function(e){e&&e.hasOwnProperty("success")&&e.success&&o.getStore().reload()})},listeners:{render:function(e){e.up("gridpanel").on("selectionchange",function(t,i,o){e.setDisabled(0===i.length)})}}},{text:"Cerrar",width:80,hidden:!0,handler:function(e,t){e.up("window").close()}}],listeners:{render:function(t){let i=t.up("gridpanel"),o=i.getSelectionModel(),n=[];e=i.getStore().on({beforeload:function(e,i,a){n=o.getSelection(),o.deselectAll(),t.items.each(function(e){e.disable()})},load:function(e,t,i,a){n=Ext.Array.map(n,function(t,i){return e.getById(t.getId())}),n=Ext.Array.clean(n),o.select(n)},destroyable:!0})}}}]},listeners:{show:function(){n.removeAll(),n.reload()},close:function(){e.destroy(),t.closeAlert().startNotifierTask()}}}).show()},showDownloadWindow:function(e,t,i){let o="default";if(t&&-1!==t.indexOf("attachment")){let e=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(t);null!==e&&e[1]&&(o=e[1].replace(/['"]/g,""))}if(this.debug("Downloading file:").debug(' > Filename: "'+o+'"').debug(' > Type: "'+e+'"').debug(" > Data length: "+Ext.util.Format.round(i.length/1024,2)+" kB (aprox.)"),null!==i&&navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([i],{type:e}),o);let n=$("<a style='display: none;'/>"),a=window.URL.createObjectURL(new Blob([i],{type:e}));$("body").append(n.attr("href",a).attr("download",o)),n[0].click(),window.URL.revokeObjectURL(a),n.remove()},buildHelper:function(){if(!this.verbose)return this;let e=document.getElementById("helper");if($._data(e,"events"))return this;let t=$(e),i=this.templates.helper_popover_tpl.apply({text:"Font Awesome 5 Free's Cheatsheet (ONLY FROM DEV!!!)"}),o=$("#container"),n=this;return t.click(function(){n.isBusy()?n.debug(":( the action could not be executed: the app is busy!."):(n.closeAlert(),Ext.create("Ext.window.Window",{title:"Font Awesome 5 Free's Cheatsheet",height:.75*o.height(),width:.75*o.width(),layout:"fit",modal:!0,defaultFocus:"[name=search]",dockedItems:[{xtype:"toolbar",dock:"top",id:"cheatsheet_toolbar",style:{backgroundColor:"white",borderBottom:"1px solid #c7bebe !important"},items:[{xtype:"label"},"->",{xtype:"combobox",name:"size",width:140,store:Ext.create("Ext.data.Store",{fields:["value"],data:[{value:"fa-2x"},{value:"fa-3x"},{value:"fa-4x"},{value:"fa-5x"},{value:"fa-6x"},{value:"fa-7x"},{value:"fa-8x"},{value:"fa-9x"},{value:"fa-10x"}]}),valueField:"value",displayField:"value",queryMode:"local",editable:!1,value:"fa-5x",listeners:{change:function(e,t,i,o){var n=$("i","#fa-container");e.getStore().each(function(e){n.removeClass(e.get("value"))}),t?n.addClass(t):n.addClass("fa-5x")}}},{xtype:"combobox",name:"text",width:140,store:Ext.create("Ext.data.Store",{fields:["value"],data:[{value:"text-dark"},{value:"text-danger"},{value:"text-warning"},{value:"text-info"},{value:"text-primary"},{value:"text-success"}]}),valueField:"value",displayField:"value",value:"text-info",queryMode:"local",editable:!1,listeners:{change:function(e,t,i,o){var n=e.getTrigger("clear"),a=$("i","#fa-container");e.getStore().each(function(e){a.removeClass(e.get("value"))}),t?(n.show(),a.addClass(t)):n.hide()}},triggers:{clear:{weight:-1,cls:Ext.baseCSSPrefix+"form-clear-trigger",handler:function(){this.setValue(null),this.updateLayout()}}}},{xtype:"textfield",name:"search",emptyText:"Search...",width:225,listeners:{change:function(e,t,i,o){e.getTrigger("clear").setVisible(t);let n=e.up("window").down("panel");Ext.isEmpty(Ext.String.trim(e.getValue()))?n.apply(n.process(n._data)):n.filter(t)}},triggers:{clear:{cls:Ext.baseCSSPrefix+"form-clear-trigger",hidden:!0,handler:function(){this.setValue(null),this.updateLayout(),this.up("window").down("panel").apply(null)}}}}]}],items:{xtype:"panel",scrollable:!0,tpl:new Ext.XTemplate('<tpl if="data">','   <div class="list-group" id="fa-container">','       <tpl for="data">','           <tpl if="!Ext.isEmpty(values)">','               <div class="list-group-item d-flex justify-content-between">','                   <tpl for=".">','                       <div class="d-flex w-100 align-items-center">','                           <tpl if="clazz && unicode">',"                               <i class=\"{clazz} {[Ext.getCmp('cheatsheet_toolbar').down('[name=size]').getValue()]} {[Ext.getCmp('cheatsheet_toolbar').down('[name=text]').getValue()]}\"></i>",'                               <div class="d-flex flex-column pl-1">','                                   <code>&lt;i class="{clazz}"&gt;&lt;/i&gt;</code>','                                   <code class="pt-1 text-muted">{unicode}</code>',"                               </div>","                           </tpl>","                       </div>","                   </tpl>","               </div>","           </tpl>","       </tpl>","   </div>","<tpl else>",'   <div class="w-100 h-100 d-flex justify-content-center align-items-center">','       <tpl if="error">','           <div class="text-danger text-uppercase font-weight-bold">{error}</div>',"       <tpl else>",'           <i class="fas fa-circle-notch fa-spin text-info fa-5x"></i>',"       </tpl>","   </div>","</tpl>"),filter:function(e){this.apply(this.process(this._data,e),e)},apply:function(e,t){this.update({data:e||this.process(this._data)});let i=t?Ext.String.format('{0} icon{2} found for "{1}".',this.count,t,this.count>1?"s":null):Ext.String.format("{0} icons.",this.count);this.up("window").down("toolbar").down("label").setText(i)},process:function(e,t){let i=Ext.Array.clone(e);if(t)try{let e=new RegExp(t.toLowerCase(),"i");i=i.filter(function(t,i){return e.test(t.clazz)||e.test(t.unicode)})}catch(e){return this.count=0,[]}this.count=i.length;let o=[];if(i.length<=3)o[0]=i;else{let e=0;for(;i.length>0;){if(i.length<3)for(let e=i.length;e<3;e++)i.push({clazz:null,unicode:null});o[e++]=i.splice(0,3)}}return o}},listeners:{show:function(e){let t=e.down("panel"),i=e.down("toolbar");t.update(null),i.items.each(function(e){e.disable()}),Ext.Ajax.request({url:n.buildURL("/_docs/fontawesome"),method:"GET",callback:function(o,n,a){if(n){let i=Ext.decode(a.responseText,!0),o=i.data;try{t._data=o,t.apply(t.process(o)),e.setTitle(Ext.String.format("Font Awesome 5 Free's Cheatsheet - {0}",i.version))}catch(e){}}else t.update({error:a.statusText});try{i.items.each(function(e){e.enable()})}catch(e){}}})}}}).show())}),t.data("bs.popover")?t.data("bs.popover").config.content=i:t.popover({trigger:"hover",placement:"bottom",html:!0,content:i,container:"body"}),t.removeAttr("hidden"),this}};window.onresize=function(){if(o.container){let e=o.container.child("div:last-child");e&&e.component&&(e.component.setSize(o.container.getWidth(),o.container.getHeight()),e.component.updateLayout())}},window.App=o,window.CONSTANTS=i}),Ext.define("Ext.form.field.ComboBoxMes",{extend:"Ext.form.field.ComboBox",alternateClassName:"Ext.form.ComboBoxMes",alias:["widget.comboboxmes","widget.combomes"],store:Ext.create("Ext.data.Store",{fields:["id","min","nombre"],data:[{id:13,min:"Anno",nombre:"Anual"},{id:1,min:"Ene",nombre:"Enero"},{id:2,min:"Feb",nombre:"Febrero"},{id:3,min:"Mar",nombre:"Marzo"},{id:4,min:"Abr",nombre:"Abril"},{id:5,min:"May",nombre:"Mayo"},{id:6,min:"Jun",nombre:"Junio"},{id:7,min:"Jul",nombre:"Julio"},{id:8,min:"Ago",nombre:"Agosto"},{id:9,min:"Sep",nombre:"Septiembre"},{id:10,min:"Oct",nombre:"Octubre"},{id:11,min:"Nov",nombre:"Noviembre"},{id:12,min:"Dic",nombre:"Diciembre"}]}),displayField:"nombre",valueField:"id"});